<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pathway Studio - Pathway Board</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #f5f5f7;
      --fg: #000000;
      --muted: #6e6e73;
      --card: #ffffff;
      --border: #d2d2d7;
      --accent: #0071e3;
      --accent-soft: #e5f0ff;
      --radius-card: 22px;
      --radius-pill: 999px;
      --accent-course: #34c759;
      --accent-activity: #0a84ff;
      --accent-career: #af52de;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui, sans-serif;
      background: linear-gradient(to bottom, #f5f5f7 0, #f0f0f5 60%, #e4e4ec 100%);
      color: var(--fg);
      display: flex;
      flex-direction: column;
    }

    header {
      padding: 16px 24px 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo-shell {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.8);
      border: 1px solid rgba(210, 210, 215, 0.9);
      backdrop-filter: blur(10px);
    }

    .logo-mark {
      width: 18px;
      height: 18px;
      border-radius: 6px;
      background: linear-gradient(135deg, #0071e3, #34c759);
    }

    .logo-text {
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 0.12em;
      text-transform: uppercase;
    }

    .btn-ghost {
      border-radius: var(--radius-pill);
      padding: 7px 14px;
      border: 1px solid rgba(210, 210, 215, 0.9);
      background: rgba(255, 255, 255, 0.8);
      font-size: 13px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    main {
      flex: 1;
      padding: 18px 24px 26px;
      display: flex;
      justify-content: center;
    }

    .shell {
      width: 100%;
      max-width: 1120px;
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 2fr);
      gap: 26px;
      align-items: flex-start;
    }

    @media (max-width: 920px) {
      .shell {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .summary-card,
    .board-card {
      background: rgba(255, 255, 255, 0.96);
      border-radius: var(--radius-card);
      padding: 20px 22px 22px;
      border: 1px solid rgba(210, 210, 215, 0.9);
      box-shadow: 0 22px 46px rgba(0, 0, 0, 0.18);
    }

    .eyebrow {
      font-size: 12px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 8px;
    }

    h1 {
      margin: 0 0 10px;
      font-size: 24px;
      letter-spacing: -0.02em;
    }

    .summary-text {
      font-size: 14px;
      color: var(--muted);
      margin-bottom: 10px;
      line-height: 1.5;
    }

    .summary-list {
      list-style: none;
      padding: 0;
      margin: 0 0 12px;
      font-size: 13px;
      color: #3a3a3c;
    }

    .summary-list li {
      margin-bottom: 4px;
    }

    .summary-grid {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 10px;
      margin-top: 8px;
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    label {
      font-size: 12px;
      font-weight: 500;
      color: #1d1d1f;
    }

    select {
      border-radius: 12px;
      border: 1px solid var(--border);
      padding: 6px 10px;
      font-size: 13px;
      font-family: inherit;
      background: #f5f5f7;
      outline: none;
      transition: border-color 0.14s ease, background 0.14s ease, box-shadow 0.14s ease;
    }

    select:focus {
      border-color: var(--accent);
      background: #ffffff;
      box-shadow: 0 0 0 1px rgba(0, 113, 227, 0.4);
    }

    .note-box {
      margin-top: 10px;
      font-size: 12px;
      color: var(--muted);
      padding: 10px 12px;
      border-radius: 14px;
      background: #f5f5f7;
      border: 1px solid #e1e1e6;
    }

    .summary-actions {
      margin-top: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .btn-primary {
      border-radius: var(--radius-pill);
      padding: 8px 16px;
      border: none;
      background: #000000;
      color: #f5f5f7;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 16px 38px rgba(0, 0, 0, 0.32);
      transition: transform 0.14s ease, box-shadow 0.14s ease, background 0.14s ease;
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      background: #111111;
      box-shadow: 0 20px 46px rgba(0, 0, 0, 0.38);
    }

    .status-text {
      font-size: 11px;
      color: var(--muted);
    }

    .board-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 14px;
    }

    .board-title {
      font-size: 18px;
      font-weight: 600;
    }

    .board-subtitle {
      font-size: 13px;
      color: var(--muted);
    }

    .legend {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      font-size: 11px;
      color: var(--muted);
    }

    .legend-item {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 8px;
      border-radius: 999px;
      background: #f5f5f7;
      border: 1px solid #e1e1e6;
    }

    .legend-item .dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
    }

    .columns {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 16px;
      margin-top: 8px;
    }

    @media (max-width: 1100px) {
      .columns {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    @media (max-width: 720px) {
      .columns {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .columns-extra {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 16px;
      margin-top: 18px;
    }

    @media (max-width: 720px) {
      .columns-extra {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .column {
      border-radius: 18px;
      padding: 12px 12px 14px;
      background: #f9f9fb;
      border: 1px solid #e1e1e6;
    }

    .column-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .column-caption {
      font-size: 11px;
      color: var(--muted);
      margin-bottom: 8px;
    }

    .semester {
      margin-top: 8px;
    }

    .semester-title {
      font-size: 12px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .bubble-group {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .bubble {
      border-radius: var(--radius-pill);
      padding: 6px 10px;
      font-size: 12px;
      line-height: 1.3;
      border: 1px solid #e1e1e6;
      cursor: pointer;
      background: #ffffff;
      color: #111111;
      box-shadow: 0 8px 18px rgba(0, 0, 0, 0.08);
      transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.12s ease, border-color 0.12s ease;
    }

    .bubble[data-kind="course"] {
      border-color: rgba(52, 199, 89, 0.4);
    }

    .bubble[data-kind="activity"] {
      border-color: rgba(10, 132, 255, 0.4);
    }

    .bubble[data-kind="career"] {
      border-color: rgba(175, 82, 222, 0.4);
    }

    .bubble:hover {
      transform: translateY(-1px);
      background: #f0f4ff;
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.12);
    }

    .bubble.highlight {
      border-color: #ff9f0a;
      box-shadow: 0 0 0 1px #ff9f0a, 0 10px 22px rgba(0, 0, 0, 0.14);
    }

    .detail-panel {
      margin-top: 12px;
      padding: 10px 12px;
      border-radius: 14px;
      background: #f5f5f7;
      border: 1px solid #e1e1e6;
      min-height: 48px;
      font-size: 12px;
      color: #3a3a3c;
    }

    .detail-title {
      font-weight: 600;
      margin-bottom: 2px;
    }

    .detail-body {
      font-size: 12px;
      color: var(--muted);
    }

    footer {
      padding: 10px 24px 18px;
      text-align: center;
      font-size: 11px;
      color: var(--muted);
    }

    .spinner {
      width: 14px;
      height: 14px;
      border-radius: 999px;
      border: 2px solid rgba(255, 255, 255, 0.6);
      border-top-color: #ffffff;
      animation: spin 0.7s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }
  </style>
</head>
<body>
<header>
  <div class="logo-shell">
    <div class="logo-mark"></div>
    <div class="logo-text">Pathway Studio</div>
  </div>
  <button class="btn-ghost" onclick="window.location.href='index.html'">
    ‹ Back
  </button>
</header>

<main>
  <div class="shell">
    <section class="summary-card">
      <div class="eyebrow">Snapshot</div>
      <h1>Four year course outline</h1>
      <p class="summary-text" id="summary-text">
        Loading student profile.
      </p>

      <ul class="summary-list" id="summary-list"></ul>

      <div class="summary-grid">
        <div class="field">
          <label for="interest-edit">Primary interest area</label>
          <select id="interest-edit">
            <option value="stem">STEM and computing</option>
            <option value="life">Life science and health</option>
            <option value="business">Business and economics</option>
            <option value="social">Social science and education</option>
            <option value="arts">Arts and media</option>
          </select>
        </div>

        <div class="field">
          <label for="career-edit">Dream career</label>
          <select id="career-edit">
            <option value="software developers">Software developers</option>
            <option value="computer and information research scientists">Computer and information research scientists</option>
            <option value="information security analysts">Information security analysts</option>
            <option value="civil engineers">Civil engineers</option>
            <option value="mechanical engineers">Mechanical engineers</option>
            <option value="registered nurses">Registered nurses</option>
            <option value="physicians and surgeons">Physicians and surgeons</option>
            <option value="clinical laboratory technologists and technicians">Clinical laboratory technologists and technicians</option>
            <option value="accountants and auditors">Accountants and auditors</option>
            <option value="financial analysts">Financial analysts</option>
            <option value="market research analysts and marketing specialists">Market research analysts and marketing specialists</option>
            <option value="kindergarten and elementary school teachers">Kindergarten and elementary school teachers</option>
            <option value="high school teachers">High school teachers</option>
            <option value="social workers">Social workers</option>
            <option value="psychologists">Psychologists</option>
            <option value="graphic designers">Graphic designers</option>
            <option value="art directors">Art directors</option>
            <option value="producers and directors">Producers and directors</option>
          </select>
        </div>
      </div>

      <div class="note-box">
        The outline shows a possible sequence of UH Mānoa courses for a 4 year bachelor program.
        It is a planning sketch, not an official program sheet. Always confirm with an academic advisor.
      </div>

      <div class="summary-actions">
        <button id="regenerate-btn" class="btn-primary">
          <span id="regenerate-label">Generate suggestions</span>
        </button>
        <div class="status-text" id="status-text"></div>
      </div>
    </section>

    <section class="board-card">
      <div class="board-header">
        <div>
          <div class="board-title">Courses, activities, and careers</div>
          <div class="board-subtitle">
            Courses by semester in 4 years, plus suggested activities and possible careers.
          </div>
        </div>
        <div class="legend">
          <div class="legend-item">
            <span class="dot" style="background: var(--accent-course);"></span>
            <span>Courses</span>
          </div>
          <div class="legend-item">
            <span class="dot" style="background: var(--accent-activity);"></span>
            <span>Activities and clubs</span>
          </div>
          <div class="legend-item">
            <span class="dot" style="background: var(--accent-career);"></span>
            <span>Careers</span>
          </div>
        </div>
      </div>

      <div class="columns">
        <div class="column">
          <div class="column-title">Year 1</div>
          <div class="column-caption">Introductory and foundation courses.</div>
          <div class="semester">
            <div class="semester-title">Fall</div>
            <div class="bubble-group" id="y1-fall"></div>
          </div>
          <div class="semester">
            <div class="semester-title">Spring</div>
            <div class="bubble-group" id="y1-spring"></div>
          </div>
        </div>

        <div class="column">
          <div class="column-title">Year 2</div>
          <div class="column-caption">Core skills and major prerequisites.</div>
          <div class="semester">
            <div class="semester-title">Fall</div>
            <div class="bubble-group" id="y2-fall"></div>
          </div>
          <div class="semester">
            <div class="semester-title">Spring</div>
            <div class="bubble-group" id="y2-spring"></div>
          </div>
        </div>

        <div class="column">
          <div class="column-title">Year 3</div>
          <div class="column-caption">Advanced major work and electives.</div>
          <div class="semester">
            <div class="semester-title">Fall</div>
            <div class="bubble-group" id="y3-fall"></div>
          </div>
          <div class="semester">
            <div class="semester-title">Spring</div>
            <div class="bubble-group" id="y3-spring"></div>
          </div>
        </div>

        <div class="column">
          <div class="column-title">Year 4</div>
          <div class="column-caption">Capstone, internships, and finishing requirements.</div>
          <div class="semester">
            <div class="semester-title">Fall</div>
            <div class="bubble-group" id="y4-fall"></div>
          </div>
          <div class="semester">
            <div class="semester-title">Spring</div>
            <div class="bubble-group" id="y4-spring"></div>
          </div>
        </div>
      </div>

      <div class="columns-extra">
        <div class="column">
          <div class="column-title">Activities and clubs</div>
          <div class="column-caption">
            Co curricular activities, clubs, and experiences that support this pathway.
          </div>
          <div class="bubble-group" id="activities-group"></div>
        </div>
        <div class="column">
          <div class="column-title">Potential careers</div>
          <div class="column-caption">
            Roles from the Occupational Outlook Handbook that line up with this plan.
          </div>
          <div class="bubble-group" id="careers-group"></div>
        </div>
      </div>

      <div class="detail-panel" id="detail-panel">
        <div class="detail-title">Select a course, activity, or career to view more detail.</div>
        <div class="detail-body"></div>
      </div>
    </section>
  </div>
</main>

<footer>
  Suggestions rely on the University of Hawaii at Mānoa course catalog 2024 to 2025 and the Occupational Outlook Handbook A to Z index.
</footer>

<script src="config.js"></script>

<script>
  let studentProfile = null;

  function loadProfile() {
    const raw = sessionStorage.getItem("studentProfile");
    if (!raw) {
      document.getElementById("summary-text").textContent =
        "No stored profile found. Return to the profile screen to start a new plan.";
      document.getElementById("regenerate-btn").disabled = true;
      return null;
    }
    try {
      return JSON.parse(raw);
    } catch {
      document.getElementById("summary-text").textContent =
        "Profile data could not be loaded. Return to the profile screen.";
      document.getElementById("regenerate-btn").disabled = true;
      return null;
    }
  }

  function mapInterestLabel(code) {
    switch (code) {
      case "stem": return "STEM and computing";
      case "life": return "Life science and health";
      case "business": return "Business and economics";
      case "social": return "Social science and education";
      case "arts": return "Arts and media";
      default: return code;
    }
  }

  function renderSummary(profile) {
    const summaryText = document.getElementById("summary-text");
    const list = document.getElementById("summary-list");

    summaryText.textContent =
      "This outline is a possible four year sequence by semester based on the student profile. It is not a formal program sheet.";

    list.innerHTML = "";

    const interestText = (profile.interests || [])
      .map(mapInterestLabel)
      .join(", ");

    const strengthsText = (profile.strengths || []).join(", ");
    const goalsText = (profile.goals || []).join(", ");

    const items = [
      "Grade: " + (profile.grade || ""),
      "Interest areas: " + (interestText || "Not set"),
      "Dream career: " + (profile.dreamCareer || ""),
      "Main strengths: " + (strengthsText || "Not set"),
      "Long term goals: " + (goalsText || "Not set")
    ];

    items.forEach(text => {
      const li = document.createElement("li");
      li.textContent = text;
      list.appendChild(li);
    });

    const firstInterest =
      (profile.interests && profile.interests[0]) || "stem";
    document.getElementById("interest-edit").value = firstInterest;
    document.getElementById("career-edit").value =
      profile.dreamCareer || "software developers";
  }

  function clearBoard() {
    const ids = [
      "y1-fall","y1-spring",
      "y2-fall","y2-spring",
      "y3-fall","y3-spring",
      "y4-fall","y4-spring",
      "activities-group",
      "careers-group"
    ];
    ids.forEach(id => {
      const el = document.getElementById(id);
      if (el) el.innerHTML = "";
    });

    const detailPanel = document.getElementById("detail-panel");
    detailPanel.querySelector(".detail-title").textContent =
      "Select a course, activity, or career to view more detail.";
    detailPanel.querySelector(".detail-body").textContent = "";
  }

  function createBubble(item, kind) {
    const btn = document.createElement("button");
    btn.type = "button";
    btn.className = "bubble";
    btn.dataset.kind = kind;
    btn.dataset.title = item.title || "";
    btn.dataset.description = item.description || "";
    btn.textContent = item.title || "(no title)";

    btn.addEventListener("click", () => {
      showDetail(item.title, item.description, kind);
      highlightConnections(item.title);
    });

    return btn;
  }

  function showDetail(title, description, kind) {
    const detailPanel = document.getElementById("detail-panel");
    const titleEl = detailPanel.querySelector(".detail-title");
    const bodyEl = detailPanel.querySelector(".detail-body");

    let prefix = "";
    if (kind === "course") prefix = "Course: ";
    else if (kind === "activity") prefix = "Activity: ";
    else if (kind === "career") prefix = "Career: ";

    titleEl.textContent = prefix + (title || "(no title)");
    bodyEl.textContent = description || "";
  }

  function highlightConnections(selectedTitle) {
    const allBubbles = Array.from(document.querySelectorAll(".bubble"));
    allBubbles.forEach(b => b.classList.remove("highlight"));

    if (!selectedTitle) return;

    const words = selectedTitle
      .toLowerCase()
      .split(/[^a-z0-9]+/)
      .filter(Boolean)
      .filter(w => !["and", "of", "the", "for", "in", "to", "with"].includes(w));

    if (words.length === 0) return;

    function matches(text) {
      if (!text) return false;
      const t = text.toLowerCase();
      return words.some(w => t.includes(w));
    }

    allBubbles.forEach(bubble => {
      const title = bubble.dataset.title || "";
      if (matches(title) || title === selectedTitle) {
        bubble.classList.add("highlight");
      }
    });
  }

  function renderBoard(plan) {
    clearBoard();

    const groupIds = {
      1: { fall: "y1-fall", spring: "y1-spring" },
      2: { fall: "y2-fall", spring: "y2-spring" },
      3: { fall: "y3-fall", spring: "y3-spring" },
      4: { fall: "y4-fall", spring: "y4-spring" }
    };

    const years = plan.years || [];

    years.forEach((yearObj, index) => {
      const yearNum = yearObj.year || (index + 1);
      const mapping = groupIds[yearNum];
      if (!mapping) return;

      const fallGroup = document.getElementById(mapping.fall);
      const springGroup = document.getElementById(mapping.spring);

      (yearObj.fall || []).forEach(course => {
        if (fallGroup) fallGroup.appendChild(createBubble(course, "course"));
      });

      (yearObj.spring || []).forEach(course => {
        if (springGroup) springGroup.appendChild(createBubble(course, "course"));
      });
    });

    const activitiesGroup = document.getElementById("activities-group");
    const careersGroup = document.getElementById("careers-group");

    (plan.activities || []).forEach(act => {
      activitiesGroup.appendChild(createBubble(act, "activity"));
    });

    (plan.careers || []).forEach(career => {
      careersGroup.appendChild(createBubble(career, "career"));
    });

    const anyCourses = years.some(
      y => (y.fall && y.fall.length) || (y.spring && y.spring.length)
    );
    const anyActivities = plan.activities && plan.activities.length;
    const anyCareers = plan.careers && plan.careers.length;

    if (!anyCourses && !anyActivities && !anyCareers) {
      const detailPanel = document.getElementById("detail-panel");
      detailPanel.querySelector(".detail-title").textContent =
        "No items returned from the AI plan.";
      detailPanel.querySelector(".detail-body").textContent =
        "Check the configuration or try generating suggestions again.";
    }
  }

  function buildSystemPrompt() {
    return (
      "You are an academic course and career planning assistant for the University of Hawaii at Mānoa. " +
      "A high school student profile is provided with grade, interest area, dream career, strengths, and long term goal. " +
      "You must design a four year bachelor program outline with eight semesters: Fall and Spring for each year. " +
      "For each semester, select at least four suitable courses from the University of Hawaii at Mānoa 2024 to 2025 course overview at https://manoa.hawaii.edu/catalog-2024-25/courses-overview/. " +
      "The courses across semesters should be related to each other, following realistic prerequisite sequences and a coherent path toward the dream career. " +
      "Also select co curricular activities, clubs, and experiences that connect skills and experiences to the chosen pathway. " +
      "Finally select potential careers only from the Occupational Outlook Handbook A to Z index at https://www.bls.gov/ooh/a-z-index.htm. " +
      "Return only valid JSON with three keys: years, activities, careers. " +
      "years must be an array of exactly four objects. Each object represents a year and must have: year (1 to 4), fall, and spring. fall and spring must each be arrays of course objects. " +
      "Each course object must have: title and description. The course description must contain 5-6 sentences that clearly explain: (1) what the course is about in details, (2) how it connects to the other courses in the four year study plan, and (3) how its knowledge and skills help students in their desired future job. " +
      "activities must be an array of objects with title and description for each suggested activity or club. " +
      "careers must be an array of objects with title and description for each possible career. " +
      "The description for every item should be brief and student friendly. " +
      "Do not include any explanation or extra commentary outside of the JSON."
    );
  }

  function buildUserPrompt(profile) {
    const interestLabel = (profile.interests || [])
      .map(mapInterestLabel)
      .join(", ");

    const strengthsText = (profile.strengths || []).join(", ");
    const goalsText = (profile.goals || []).join(", ");

    return (
      "Student profile:\n" +
      "Grade: " + (profile.grade || "") + "\n" +
      "Interest areas: " + (interestLabel || "Not provided") + "\n" +
      "Dream career: " + (profile.dreamCareer || "") + "\n" +
      "Main strengths: " + (strengthsText || "Not provided") + "\n" +
      "Long term goals: " + (goalsText || "Not provided") + "\n\n" +
      "Using this profile, propose a four year bachelor program with Fall and Spring semesters and return JSON as requested."
    );
  }

  async function callOpenAI(profile) {
    const apiKey = window.OPENAI_API_KEY;
    if (!apiKey) {
      throw new Error("OPENAI_API_KEY is not defined in config.js");
    }

    const systemContent = buildSystemPrompt();
    const userContent = buildUserPrompt(profile);

    const payload = {
      model: "gpt-4.1-mini",
      messages: [
        { role: "system", content: systemContent },
        { role: "user", content: userContent }
      ],
      temperature: 0.7,
      max_tokens: 20000
    };

    const response = await fetch("https://api.openai.com/v1/chat/completions", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer " + apiKey
      },
      body: JSON.stringify(payload)
    });

    if (!response.ok) {
      throw new Error("API error: " + response.status);
    }

    const data = await response.json();
    const text = data.choices?.[0]?.message?.content?.trim();
    if (!text) {
      throw new Error("Empty response from API");
    }

    let plan;
    try {
      plan = JSON.parse(text);
    } catch (e) {
      const firstBrace = text.indexOf("{");
      const lastBrace = text.lastIndexOf("}");
      if (firstBrace !== -1 && lastBrace !== -1 && lastBrace > firstBrace) {
        const jsonSlice = text.slice(firstBrace, lastBrace + 1);
        plan = JSON.parse(jsonSlice);
      } else {
        throw new Error("Response was not valid JSON");
      }
    }
    return plan;
  }

  async function generatePlan() {
    if (!studentProfile) return;

    const statusEl = document.getElementById("status-text");
    const button = document.getElementById("regenerate-btn");
    const label = document.getElementById("regenerate-label");

    statusEl.textContent = "Request sent to AI planning assistant.";
    button.disabled = true;
    label.innerHTML = '<span class="spinner"></span>';

    clearBoard();

    try {
      const plan = await callOpenAI(studentProfile);
      renderBoard(plan);
      statusEl.textContent = "Suggestions updated.";
    } catch (err) {
      console.error(err);
      statusEl.textContent = "Suggestions could not be loaded. Check configuration or try again.";
    } finally {
      button.disabled = false;
      label.textContent = "Generate suggestions";
    }
  }

  studentProfile = loadProfile();
  if (studentProfile) {
    renderSummary(studentProfile);

    document.getElementById("interest-edit").addEventListener("change", (e) => {
      // Treat this as the primary interest and store it as the first element
      studentProfile.interests = [e.target.value];
      sessionStorage.setItem("studentProfile", JSON.stringify(studentProfile));
      renderSummary(studentProfile);
    });

    document.getElementById("career-edit").addEventListener("change", (e) => {
      studentProfile.dreamCareer = e.target.value;
      sessionStorage.setItem("studentProfile", JSON.stringify(studentProfile));
      renderSummary(studentProfile);
    });

    document.getElementById("regenerate-btn").addEventListener("click", () => {
      generatePlan();
    });

    generatePlan();
  }
</script>
</body>
</html>
